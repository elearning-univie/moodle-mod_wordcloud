{"version":3,"file":"addwordtowordcloud.min.js","sources":["../src/addwordtowordcloud.js"],"sourcesContent":["import ajax from 'core/ajax';\nimport notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\n\nconst addwordtowordcloud = (() => {\n    // Private variables\n    let aid, listview, timestamphtml, refreshtime;\n\n    // Function to add a new word\n    const addWord = () => {\n        const newWord = document.getElementById('mod-wordcloud-new-word');\n        const wordBox = document.getElementById('mod-wordcloud-words-box');\n        const wordCount = document.getElementById('mod-wordcloud-wcount');\n        const viewMenu = document.getElementById('mod-wordcloud-view-menu');\n\n        const word = newWord.value.trim();\n        if (!word) {return;}\n\n        // AJAX call to add the word to the word cloud\n        ajax.call([{\n            methodname: 'mod_wordcloud_add_word',\n            args: { aid, word, listview },\n            done: (returnval) => {\n                if (!returnval.cloudhtml) {\n                    // Show warning modal if there's an error\n                    ModalFactory.create({\n                        type: ModalFactory.types.CANCEL,\n                        title: getString('warning', 'mod_wordcloud'),\n                        body: returnval.warnings[0].message\n                    }).then(modal => modal.show());\n                } else {\n                    // Update word cloud\n                    wordBox.innerHTML = returnval.cloudhtml;\n                    wordCount.textContent = returnval.sumcount;\n                    newWord.value = '';\n                    viewMenu.disabled = false;\n                }\n            },\n            fail: notification.exception\n        }]);\n    };\n\n    // Function to auto-refresh the word cloud periodically\n    const autoRefreshWords = () => {\n        const wordBox = document.getElementById('mod-wordcloud-words-box');\n        const wordCount = document.getElementById('mod-wordcloud-wcount');\n\n        setInterval(() => {\n            ajax.call([{\n                methodname: 'mod_wordcloud_get_words',\n                args: { aid, timestamphtml, listview },\n                done: (returnval) => {\n                    if (returnval.cloudhtml) {\n                        wordBox.innerHTML = returnval.cloudhtml;\n                        wordCount.textContent = returnval.sumcount;\n                        timestamphtml = returnval.timestamphtml;\n                    }\n                },\n                fail: notification.exception\n            }]);\n        }, refreshtime * 1000);\n    };\n\n    return {\n        init: (refreshTime, aidParam, timestampHtmlParam, listviewParam) => {\n            refreshtime = refreshTime;\n            aid = aidParam;\n            timestamphtml = timestampHtmlParam;\n            listview = listviewParam;\n\n            const wordInput = document.getElementById('mod-wordcloud-new-word');\n            const addButton = document.getElementById('mod-wordcloud-btn');\n\n            wordInput.addEventListener('keypress', (e) => {\n                if (e.keyCode === 13) {\n                    addButton.click();\n                }\n            });\n\n            addButton.addEventListener('click', addWord);\n\n            // Start auto-refresh of word cloud\n            autoRefreshWords();\n        }\n    };\n})();\n\nexport default addwordtowordcloud;"],"names":["aid","listview","timestamphtml","refreshtime","addWord","newWord","document","getElementById","wordBox","wordCount","viewMenu","word","value","trim","call","methodname","args","done","returnval","cloudhtml","innerHTML","textContent","sumcount","disabled","create","type","ModalFactory","types","CANCEL","title","body","warnings","message","then","modal","show","fail","notification","exception","init","refreshTime","aidParam","timestampHtmlParam","listviewParam","wordInput","addButton","addEventListener","e","keyCode","click","setInterval","autoRefreshWords"],"mappings":"+eAK2B,UAEnBA,IAAKC,SAAUC,cAAeC,kBAG5BC,QAAU,WACNC,QAAUC,SAASC,eAAe,0BAClCC,QAAUF,SAASC,eAAe,2BAClCE,UAAYH,SAASC,eAAe,wBACpCG,SAAWJ,SAASC,eAAe,2BAEnCI,KAAON,QAAQO,MAAMC,OACtBF,oBAGAG,KAAK,CAAC,CACPC,WAAY,yBACZC,KAAM,CAAEhB,IAAAA,IAAKW,KAAAA,KAAMV,SAAAA,UACnBgB,KAAOC,YACEA,UAAUC,WASXX,QAAQY,UAAYF,UAAUC,UAC9BV,UAAUY,YAAcH,UAAUI,SAClCjB,QAAQO,MAAQ,GAChBF,SAASa,UAAW,0BAVPC,OAAO,CAChBC,KAAMC,uBAAaC,MAAMC,OACzBC,OAAO,mBAAU,UAAW,iBAC5BC,KAAMZ,UAAUa,SAAS,GAAGC,UAC7BC,MAAKC,OAASA,MAAMC,UAS/BC,KAAMC,sBAAaC,oBAyBpB,CACHC,KAAM,CAACC,YAAaC,SAAUC,mBAAoBC,iBAC9CxC,YAAcqC,YACdxC,IAAMyC,SACNvC,cAAgBwC,mBAChBzC,SAAW0C,oBAELC,UAAYtC,SAASC,eAAe,0BACpCsC,UAAYvC,SAASC,eAAe,qBAE1CqC,UAAUE,iBAAiB,YAAaC,IAClB,KAAdA,EAAEC,SACFH,UAAUI,WAIlBJ,UAAUC,iBAAiB,QAAS1C,SApCnB,YACfI,QAAUF,SAASC,eAAe,2BAClCE,UAAYH,SAASC,eAAe,wBAE1C2C,aAAY,mBACHpC,KAAK,CAAC,CACPC,WAAY,0BACZC,KAAM,CAAEhB,IAAAA,IAAKE,cAAAA,cAAeD,SAAAA,UAC5BgB,KAAOC,YACCA,UAAUC,YACVX,QAAQY,UAAYF,UAAUC,UAC9BV,UAAUY,YAAcH,UAAUI,SAClCpB,cAAgBgB,UAAUhB,gBAGlCkC,KAAMC,sBAAaC,eAEV,IAAdnC,cAsBCgD,MA9Ee"}