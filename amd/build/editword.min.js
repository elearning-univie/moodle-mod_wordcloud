define("mod_wordcloud/editword",["exports","core/ajax","core/notification","core/modal_cancel","core/modal_save_cancel","core/modal_events","core/str"],(function(_exports,_ajax,_notification,_modal_cancel,_modal_save_cancel,_modal_events,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.modWordcloudUpdateEntry=_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_modal_cancel=_interopRequireDefault(_modal_cancel),_modal_save_cancel=_interopRequireDefault(_modal_save_cancel),_modal_events=_interopRequireDefault(_modal_events);const modWordcloudUpdateEntry=async(aid,backurl)=>{let wordlist=document.querySelectorAll(".mod-wordcloud-edit-word");const changes=[],doubleentries=[],allentries=new Set,collectedentries=new Set;if(wordlist.forEach((worditem=>{allentries.has(worditem.value)?doubleentries.push(worditem.value):allentries.add(worditem.value),worditem.dataset.word!=worditem.value&&(changes.push({wordid:worditem.dataset.id,newword:worditem.value,newcount:document.getElementById("mod-wordcloud-count"+worditem.dataset.id).value}),collectedentries.add(worditem.dataset.id))})),wordlist=document.querySelectorAll(".mod-wordcloud-edit-count"),wordlist.forEach((worditem=>{worditem.dataset.count==worditem.value||collectedentries.has(worditem.dataset.id)||changes.push({wordid:worditem.dataset.id,newword:document.getElementById("mod-wordcloud-word"+worditem.dataset.id).value,newcount:worditem.value})})),doubleentries.length){const modal=await _modal_save_cancel.default.create({title:(0,_str.get_string)("warning","mod_wordcloud"),body:confirmationMessage(doubleentries.toString())});modal.getRoot().on(_modal_events.default.save,(e=>{e.preventDefault(),sendWsCall(aid,changes,backurl)})),modal.getRoot().on(_modal_events.default.cancel,(()=>{location.reload()})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()}else sendWsCall(aid,changes,backurl)};_exports.modWordcloudUpdateEntry=modWordcloudUpdateEntry;const confirmationMessage=async data=>await(0,_str.get_string)("warningdoubleentries","mod_wordcloud")+data,sendWsCall=(aid,changes,backurl)=>{_ajax.default.call([{methodname:"mod_wordcloud_update_entry",args:{aid:aid,entry:changes},done:async function(returnval){if(returnval.success)location.href=backurl;else{const modal=await _modal_cancel.default.create({title:(0,_str.get_string)("warning","mod_wordcloud"),body:returnval.warnings[0].message});modal.getRoot().on(_modal_events.default.cancel,(()=>{location.reload()})),modal.show()}},fail:_notification.default.exception}])};_exports.init=()=>{const updateButton=document.getElementById("mod-wordcloud-update-btn");updateButton&&updateButton.addEventListener("click",(e=>{const aid=e.target.dataset.aid,backurl=e.target.dataset.backurl;modWordcloudUpdateEntry(aid,backurl)}))}}));

//# sourceMappingURL=editword.min.js.map