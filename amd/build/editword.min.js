define("mod_wordcloud/editword",["exports","jquery","core/ajax","core/notification","core/modal_factory","core/modal_events","core/str"],(function(_exports,_jquery,_ajax,_notification,_modal_factory,_modal_events,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);_exports.init=()=>{_jquery.default.mod_wordcloud_update_entry=function(aid,backurl){let wordlist=document.querySelectorAll(".mod-wordcloud-edit-word");const changes=[],doubleentries=[],allentries=new Set,collectedentries=new Set;for(let i=0;i<wordlist.length;i++){let worditem=wordlist[i];allentries.has(worditem.value)?doubleentries.push(worditem.value):allentries.add(worditem.value),worditem.dataset.word!=worditem.value&&(changes.push({wordid:worditem.dataset.id,newword:worditem.value,newcount:document.getElementById("mod-wordcloud-count"+worditem.dataset.id).value}),collectedentries.add(worditem.dataset.id))}wordlist=document.querySelectorAll(".mod-wordcloud-edit-count");for(let i=0;i<wordlist.length;i++){let worditem=wordlist[i];worditem.dataset.count!=worditem.value&&(collectedentries.has(worditem.dataset.id)||changes.push({wordid:worditem.dataset.id,newword:document.getElementById("mod-wordcloud-word"+worditem.dataset.id).value,newcount:worditem.value}))}doubleentries.length?_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:(0,_str.get_string)("warning","mod_wordcloud"),body:confirmationMessage(doubleentries.toString())}).then((function(modal){modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),sendWsCall(aid,changes,backurl)})),modal.getRoot().on(_modal_events.default.cancel,(()=>{location.reload()})),modal.getRoot().on(_modal_events.default.hidden,(()=>{modal.destroy()})),modal.show()})):sendWsCall(aid,changes,backurl)}};const confirmationMessage=async data=>await(0,_str.get_string)("warningdoubleentries","mod_wordcloud")+data,sendWsCall=(aid,changes,backurl)=>{_ajax.default.call([{methodname:"mod_wordcloud_update_entry",args:{aid:aid,entry:changes},done:function(returnval){returnval.success?location.href=backurl:_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:(0,_str.get_string)("warning","mod_wordcloud"),body:returnval.warnings[0].message}).then((function(modal){modal.getRoot().on(_modal_events.default.cancel,(()=>{location.reload()})),modal.show()}))},fail:_notification.default.exception}])}}));

//# sourceMappingURL=editword.min.js.map